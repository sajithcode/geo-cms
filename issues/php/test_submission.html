<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Issue Submission</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-box {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      button {
        padding: 10px 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      .log {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
        max-height: 300px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
      }
      .success {
        color: green;
      }
      .error {
        color: red;
      }
      .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
      }
      .notification {
        background: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        margin-bottom: 10px;
        min-width: 300px;
        opacity: 0;
        transform: translateX(400px);
        transition: all 0.3s ease;
      }
      .notification.show {
        opacity: 1;
        transform: translateX(0);
      }
      .notification-success {
        border-left: 4px solid #28a745;
      }
      .notification-error {
        border-left: 4px solid #dc3545;
      }
      .notification-content {
        display: flex;
        align-items: center;
        gap: 10px;
      }
    </style>
  </head>
  <body>
    <h1>ðŸ§ª Issue Submission Test</h1>

    <div class="test-box">
      <h2>Test 1: Check if script.js is loaded</h2>
      <button onclick="testScriptLoaded()">Test Script.js</button>
      <div id="script-test" class="log"></div>
    </div>

    <div class="test-box">
      <h2>Test 2: Test showNotification function</h2>
      <button onclick="testNotification('success')">Show Success</button>
      <button onclick="testNotification('error')">Show Error</button>
      <button onclick="testNotification('warning')">Show Warning</button>
      <button onclick="testNotification('info')">Show Info</button>
      <div id="notification-test" class="log"></div>
    </div>

    <div class="test-box">
      <h2>Test 3: Test hideModal function</h2>
      <button onclick="testHideModal()">Test hideModal</button>
      <div id="modal-test" class="log"></div>
    </div>

    <div class="test-box">
      <h2>Test 4: Test actual form submission</h2>
      <button onclick="testFormSubmission()">Submit Test Issue</button>
      <div id="submit-test" class="log"></div>
    </div>

    <div class="test-box">
      <h2>Test 5: Check recent issues in database</h2>
      <button onclick="checkRecentIssues()">Check Database</button>
      <div id="db-test" class="log"></div>
    </div>

    <div id="notification-container" class="notification-container"></div>

    <!-- Test modal -->
    <div
      id="test-modal"
      class="modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9998;
        align-items: center;
        justify-content: center;
      "
    >
      <div style="background: white; padding: 20px; border-radius: 8px">
        <h3>Test Modal</h3>
        <p>This is a test modal</p>
        <button onclick="hideModal('test-modal')">Close</button>
      </div>
    </div>

    <script src="../js/script.js"></script>
    <script>
      function log(elementId, message, type = "info") {
        const logDiv = document.getElementById(elementId);
        const time = new Date().toLocaleTimeString();
        const className =
          type === "success" ? "success" : type === "error" ? "error" : "";
        logDiv.innerHTML += `<div class="${className}">[${time}] ${message}</div>`;
      }

      function testScriptLoaded() {
        const testDiv = document.getElementById("script-test");
        testDiv.innerHTML = "";

        log("script-test", "Testing if functions exist...", "info");

        if (typeof showNotification === "function") {
          log("script-test", "âœ“ showNotification exists", "success");
        } else {
          log("script-test", "âœ— showNotification NOT found", "error");
        }

        if (typeof hideModal === "function") {
          log("script-test", "âœ“ hideModal exists", "success");
        } else {
          log("script-test", "âœ— hideModal NOT found", "error");
        }

        if (typeof showModal === "function") {
          log("script-test", "âœ“ showModal exists", "success");
        } else {
          log("script-test", "âœ— showModal NOT found", "error");
        }
      }

      function testNotification(type) {
        const messages = {
          success: "Test success notification!",
          error: "Test error notification!",
          warning: "Test warning notification!",
          info: "Test info notification!",
        };

        log(
          "notification-test",
          `Calling showNotification('${messages[type]}', '${type}')`,
          "info"
        );

        try {
          showNotification(messages[type], type);
          log("notification-test", "âœ“ Notification triggered", "success");
        } catch (error) {
          log("notification-test", "âœ— Error: " + error.message, "error");
        }
      }

      function testHideModal() {
        const testDiv = document.getElementById("modal-test");
        testDiv.innerHTML = "";

        log("modal-test", "Showing test modal...", "info");

        const modal = document.getElementById("test-modal");
        modal.style.display = "flex";

        setTimeout(() => {
          log("modal-test", "Calling hideModal...", "info");
          try {
            hideModal("test-modal");
            log("modal-test", "âœ“ Modal hidden successfully", "success");
          } catch (error) {
            log("modal-test", "âœ— Error: " + error.message, "error");
          }
        }, 2000);
      }

      async function testFormSubmission() {
        const testDiv = document.getElementById("submit-test");
        testDiv.innerHTML = "";

        log("submit-test", "Creating test form data...", "info");

        const formData = new FormData();
        formData.append("csrf_token", "test_token");
        formData.append("computer_serial_no", "LAB01-PC01");
        formData.append("lab_id", "1");
        formData.append("issue_category", "hardware");
        formData.append("description", "Test issue from test page");

        log("submit-test", "Submitting to php/submit_issue.php...", "info");

        try {
          const response = await fetch("../issues/php/submit_issue.php", {
            method: "POST",
            body: formData,
          });

          log("submit-test", `Response status: ${response.status}`, "info");

          const contentType = response.headers.get("content-type");
          log("submit-test", `Content-Type: ${contentType}`, "info");

          const text = await response.text();
          log("submit-test", `Raw response: ${text}`, "info");

          try {
            const result = JSON.parse(text);
            log(
              "submit-test",
              `Parsed JSON: ${JSON.stringify(result)}`,
              "info"
            );

            if (result.success) {
              log("submit-test", "âœ“ Issue submitted successfully!", "success");
              log("submit-test", `Report ID: ${result.report_id}`, "success");
              showNotification("Issue reported successfully!", "success");
            } else {
              log("submit-test", `âœ— Failed: ${result.message}`, "error");
              showNotification(result.message, "error");
            }
          } catch (e) {
            log("submit-test", `âœ— JSON parse error: ${e.message}`, "error");
          }
        } catch (error) {
          log("submit-test", `âœ— Fetch error: ${error.message}`, "error");
        }
      }

      async function checkRecentIssues() {
        const testDiv = document.getElementById("db-test");
        testDiv.innerHTML = "";

        log("db-test", "Checking recent issues...", "info");

        try {
          const response = await fetch("../issues/php/check_recent_issues.php");
          const text = await response.text();

          log("db-test", text, "info");
        } catch (error) {
          log("db-test", `âœ— Error: ${error.message}`, "error");
        }
      }

      // Auto-run first test on load
      window.addEventListener("load", () => {
        testScriptLoaded();
      });
    </script>
  </body>
</html>
